<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">TechStore</a>
    <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#menu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <form class="d-flex mx-auto position-relative" role="search" method="get" action="{% url 'search' %}">
      <input
        class="form-control me-2"
        type="search"
        name="q"
        placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π..."
        aria-label="Search"
        id="searchInput"
        autocomplete="off"
        style="width: 320px;"
      >
      <button class="btn btn-outline-light" type="submit">–ü–æ–∏—Å–∫</button>

      <!--  –ê–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–∫–∏ -->
      <div id="suggestionsBox" class="list-group position-absolute w-100 mt-1 shadow" 
           style="z-index: 2000; display: none;">
      </div>
    </form>
    <div class="collapse navbar-collapse" id="menu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li class="nav-item"><a class="nav-link" href="/about/">–û –Ω–∞—Å</a></li>
        <li class="nav-item"><a class="nav-link" href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
        <li class="nav-item"><a class="nav-link" href="/cart/">–ö–æ—Ä–∑–∏–Ω–∞</a></li>

        {% if request.session.is_admin %}
  <!-- üîπ –ú–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
      –ê–¥–º–∏–Ω
    </a>
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" href="{% url 'admin_panel' %}">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
      <li><a class="dropdown-item" href="{% url 'logout' %}">–í—ã–π—Ç–∏</a></li>
    </ul>
  </li>

{% elif request.session.user_id %}
  <!-- üîπ –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" id="profileMenu" role="button" data-bs-toggle="dropdown">
      –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
    </a>
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" href="{% url 'orders_list' %}">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a></li>
      <li><a class="dropdown-item" href="{% url 'orders_history' %}">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item" href="{% url 'logout' %}">–í—ã–π—Ç–∏</a></li>
    </ul>
  </li>

{% else %}
  <!-- üîπ –ï—Å–ª–∏ –Ω–µ –≤–æ—à—ë–ª -->
  <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">–í–æ–π—Ç–∏</a></li>
{% endif %}
      </ul>
    </div>
  </div>
</nav>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("searchInput");
  const box = document.getElementById("suggestionsBox");

  input.addEventListener("input", async () => {
    const query = input.value.trim();
    if (query.length < 2) {
      box.style.display = "none";
      return;
    }

    const response = await fetch(`/search_suggestions/?q=${encodeURIComponent(query)}`);
    const data = await response.json();

    if (data.suggestions.length > 0) {
      box.innerHTML = data.suggestions.map(item =>
        `<a href="${item.url}" class="list-group-item list-group-item-action">
          ${item.name} <span class="text-muted small">${item.type}</span>
        </a>`
      ).join("");
      box.style.display = "block";
    } else {
      box.innerHTML = `<div class="list-group-item text-muted">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
      box.style.display = "block";
    }
  });

  document.addEventListener("click", (e) => {
    if (!box.contains(e.target) && e.target !== input) {
      box.style.display = "none";
    }
  });
});
</script>

<style>
/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–∏—Å–∫–∞ */
.navbar form[role="search"] {
  position: relative;
  z-index: 1050; /* —á—Ç–æ–±—ã –±—ã–ª –≤—ã—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
#suggestionsBox {
  position: absolute;
  top: 100%; /* —Å—Ä–∞–∑—É –ø–æ–¥ –∏–Ω–ø—É—Ç–æ–º */
  left: 0;
  width: 100%;
  max-height: 250px;
  overflow-y: auto;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 0.375rem;
  z-index: 2000; /* –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
}

/* –≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ */
#suggestionsBox .list-group-item {
  cursor: pointer;
}

#suggestionsBox .list-group-item:hover {
  background-color: #f8f9fa;
}
</style>
