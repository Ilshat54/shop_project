{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - TechStore</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="bg-light">

{% include "main/navbar.html" %}
<!-- üîπ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
{% if messages %}
  <div id="alert-container" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1100;">
    {% for message in messages %}
      <div class="alert alert-info alert-dismissible fade show shadow" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}
<div class="container py-5">
  <h1 class="mb-4 text-center">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#users" type="button">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#products" type="button">–¢–æ–≤–∞—Ä—ã</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#orders" type="button">–ó–∞–∫–∞–∑—ã</button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div class="tab-pane fade show active" id="users">
      <h4>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
      <table class="table table-striped table-hover mt-3">
        <thead class="table-dark">
          <tr><th>ID</th><th>–ò–º—è</th><th>Email</th><th>–†–æ–ª—å</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr>
            <td>{{ u.user_id }}</td>
            <td>{{ u.name }}</td>
            <td>{{ u.email }}</td>
            <td>{% if u.is_admin %}<span class="badge bg-danger">–ê–¥–º–∏–Ω</span>{% else %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å{% endif %}</td>
            <td>
              {% if not u.is_admin %}
              <a href="{% url 'delete_user' u.user_id %}" class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- –¢–æ–≤–∞—Ä—ã -->
    <div class="tab-pane fade" id="products">
      <h4>üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h4>
      <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
      <form action="{% url 'add_product' %}" method="post" class="card p-3 shadow-sm mb-4">
        {% csrf_token %}
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">–¶–µ–Ω–∞ (‚ÇΩ)</label>
            <input type="number" step="0.01" name="price" class="form-control" required>
          </div>
          <div class="col-md-3">
            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select name="category" class="form-select" required>
              {% for cat in categories %}
                <option value="{{ cat.category_id }}">{{ cat.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–ø—É—Ç—å)</label>
            <input type="text" name="image" class="form-control" placeholder="images/product.jpg">
          </div>
          <div class="col-md-1 text-end">
            <button class="btn btn-success w-100" type="submit">‚ûï</button>
          </div>
        </div>
      </form>

      <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
      <table class="table table-striped table-hover mt-3">
        <thead class="table-dark">
          <tr><th>ID</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–¶–µ–Ω–∞</th><th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr>
            <td>{{ p.product_id }}</td>
            <td>{{ p.name }}</td>
            <td>{{ p.price }} ‚ÇΩ</td>
            <td>{{ p.category.name }}</td>
            <td>
              <a href="{% url 'edit_product' p.product_id %}" class="btn btn-sm btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</a>
              <a href="{% url 'delete_product' p.product_id %}" class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- –ó–∞–∫–∞–∑—ã -->
    <div class="tab-pane fade" id="orders">
      <h4>üßæ –ó–∞–∫–∞–∑—ã</h4>
      <table class="table table-striped table-hover mt-3">
        <thead class="table-dark">
          <tr><th>ID</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–î–∞—Ç–∞</th><th>–ê–¥—Ä–µ—Å</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ò–∑–º–µ–Ω–∏—Ç—å</th></tr>
        </thead>
        <tbody>
          {% for o in orders %}
          <tr>
            <td>{{ o.order_id }}</td>
            <td>{{ o.user.name }}</td>
            <td>{{ o.order_date|date:"d.m.Y H:i" }}</td>
            <td>{{ o.address }}</td>
            <td>
              <span class="badge 
                {% if o.status == '–ì–æ—Ç–æ–≤' %}bg-success
                {% elif o.status == '–í –ø—É—Ç–∏' %}bg-warning
                {% else %}bg-secondary{% endif %}">
                {{ o.status }}
              </span>
            </td>
            <td>
              <div class="btn-group">
                <a href="{% url 'change_order_status' o.order_id %}?status=–ê–∫—Ç–∏–≤–Ω—ã–π" class="btn btn-sm btn-outline-primary">–ê–∫—Ç–∏–≤–Ω—ã–π</a>
                <a href="{% url 'change_order_status' o.order_id %}?status=–í –ø—É—Ç–∏" class="btn btn-sm btn-outline-warning">–í –ø—É—Ç–∏</a>
                <a href="{% url 'change_order_status' o.order_id %}?status=–ì–æ—Ç–æ–≤" class="btn btn-sm btn-outline-success">–ì–æ—Ç–æ–≤</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<footer id="contacts" class="bg-dark text-white text-center py-4">
  <div class="container">
    <h5>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h5>
    <p>Email: support@techstore.ru | –¢–µ–ª: +7 (999) 123-45-67</p>
    <p>¬© 2025 TechStore | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
  </div>
</footer>
<script>
  // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(el => {
      let bsAlert = new bootstrap.Alert(el);
      bsAlert.close();
    });
  }, 3000); // 3000 = 3 —Å–µ–∫
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const params = new URLSearchParams(window.location.search);
    const tab = params.get("tab");

    if (tab) {
      const tabButton = document.querySelector(`[data-bs-target="#${tab}"]`);
      const tabContent = document.querySelector(`#${tab}`);

      if (tabButton && tabContent) {
        const tabTrigger = new bootstrap.Tab(tabButton);
        tabTrigger.show();
      }
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
